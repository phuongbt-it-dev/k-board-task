"use strict";function __delTask(){var e=getParameterByName("id");if(!confirm("Bạn có chắc chắn xóa task này?"))return!1;$.ajax({url:"/delete",type:"POST",dataType:"json",cache:!0,data:{id:e},beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+Cookies.get("Token"))},complete:function(e){window.location.href="/"}})}function __archiveTask(){var e=getParameterByName("id");if(!confirm("Bạn có chắc chắn lưu trữ task này?"))return!1;$.ajax({url:"/archive",type:"POST",dataType:"json",cache:!0,data:{id:e,State:"N"},beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+Cookies.get("Token"))},complete:function(e){window.location.href="/"}})}function __gettask_getLists(){var c=getParameterByName("id");$.ajax({url:Global.API_URL+"/tasks.json?id="+c,type:"GET",async:!0,dataType:"json",cache:!0,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+Cookies.get("Token"))},error:function(e,a,t){},complete:function(e){var a=JSON.parse(e.responseText);for(var t in a){if(a.hasOwnProperty(t))(n=a[t].ObjectId)===c&&(a=a[t])}var r="secondary";for(var s in 1==a.MetaIndex?r="primary":2==a.MetaIndex?r="success":3==a.MetaIndex&&(r="danger"),$(".taskdetails .card").addClass("border-"+r),$(".taskdetails .card-header").addClass("bg-"+r),a)if(a.hasOwnProperty(s)){var n=a[s];"createddate"===s.toLowerCase()||"activatedts"===s.toLowerCase()?$("#data-"+s.toLowerCase()).html(moment(checkNull(n)).format("DD/MM/YYYY")+" lúc "+moment(checkNull(n)).format("HH:mm")):$("#data-"+s.toLowerCase()).html(checkNull(n)),$("#key-"+s.toLowerCase()).html(checkNull(s))}var o='<span class="badge badge-light p-1">Không hiệu lực</span>';"P"===a.State?o='<span class="badge badge-secondary p-1">Nhiệm vụ</span>':"I"===a.State?o='<span class="badge badge-info p-1">Đang thực thi</span>':"D"===a.State&&(o='<span class="badge badge-success p-1">Hoàn thành</span>',Settings.Permission.DeleteTask&&$(".del").removeClass("d-none"),Settings.Permission.ArchiveTask&&$(".archive").removeClass("d-none")),a.MetaTextValue&&0<a.MetaTextValue.length&&$(".viewpdf").removeClass("d-none"),$("#jobstates-state").html(o),$("#data-createuser").html('<a href="/getuser?id='+a.CreateID+'">'+getUserName(a.CreateID)+"</a>"),$("#data-workuser").html('<a href="/getuser?id='+a.workID+'">'+getUserName(a.workID)+"</a>"),$("#pdffiles").attr("data-files",a.MetaTextValue),"true"===getParameterByName("archive")&&($(".archivenote").removeClass("d-none"),$(".del").removeClass("d-none"))}})}checkLogin("viewtask"),$(document).ready(function(){__gettask_getLists(),__main__callAction(),__main__addForm()});