"use strict";function __addTask_submitForm(){Settings.Editor&&1==Settings.Editor&&($('label[for="message"]').hide(),tinymce.init({selector:"#message",forced_root_block:"div",height:100,menubar:!0,theme:"modern",plugins:["advlist autolink lists link image charmap print preview anchor textcolor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste code help wordcount code"],toolbar:"formatselect | bold italic forecolor backcolor  | alignleft aligncenter alignright | bullist numlist removeformat | code"})),$("#datepicker").datetimepicker({controlType:"select",oneLine:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm"}),$("#customFile").on("change paste keyup",function(e){var t=e.target.files[0].name;$("#customFileLabel").html(t)}),$("form.validator").validator().on("submit",function(e){return e.isDefaultPrevented()?alert("Vui lòng kiểm tra lại thông tin"):(Settings.Editor&&Settings.Editor,App.txtNewMesage=$("#message").val(),App.txtNewTitle=$("#text").val(),App.txtNewSelect=$("#select").val(),App.txtNewDate=$("#datepicker").val(),App.txtNewProject=$("#namepro").val(),App.txtNewColor=$("#color").val(),App.txtNewMaterial=$("#material").val(),upLoadPDF(App.txtNewTitle,App.txtNewSelect,App.txtNewMesage,App.txtNewDate,App.txtNewProject,App.txtNewColor,App.txtNewMaterial)),!1})}function __addTask_createTask(e,t,a,o,r,n,s,l){var i=moment(Date.now()).format("YYYY-MM-DD")+" "+moment(Date.now()).format("HH:mm"),m=JSON.stringify({ObjectType:Settings.GlobalName,ObjectId:md5(e).substring(0,10)+"-"+md5(i).substring(0,5)+"-"+md5(makeid(5)).substring(0,5)+"-"+md5(makeid(10)).substring(0,10)+"-"+md5(makeid(5)).substring(0,15),MetaIndex:parseInt(t),Name:e,order:0,CreatedDate:i,MetaDescription:a,MetaTextValue:r,CreateID:parseInt(localStorage.getItem("CurrentUserID")),workID:parseInt(App.workID),State:"P",ActivatedTS:o,Project:n,Material:l,Est:s,from:App.from,to:App.to});$.ajax({url:"/save",type:"POST",async:!0,dataType:"json",cache:!0,data:m,contentType:"application/json; charset=utf-8",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+Cookies.get("Token"))},error:function(e,t,a){},complete:function(e){}})}function upLoadPDF(t,a,o,r,n,s,l){var e=new FormData($("#addtask")[0]);return $.ajax({url:"/upload",type:"POST",contentType:!1,processData:!1,cache:!1,data:e,success:function(e){"error"===e.toString()?alert("Chỉ hỗ trợ tập tin PDF"):(__addTask_createTask(t,a,o,r,e,n,s,l),alert("Đã cập nhật task mới!"),toastrMsg("Cập nhật hoàn tất","Cập nhật",2e3),$("#addtask")[0].reset(),$("#customFileLabel").html(""))},error:function(){alert("Lỗi khi upload!")}}),!1}function buildDemoTask(){$("#select").on("change keypress",function(e){$(".list-group-item").removeClass("status-3").removeClass("status-2").removeClass("status-1").removeClass("status-0"),$(".list-group-item").addClass("status-"+e.target.value),$(".list-group-item .pot").removeClass("pot-3").removeClass("pot-2").removeClass("pot-1").removeClass("pot-0"),$(".list-group-item .pot").addClass("pot-"+e.target.value)}),$("#addtask input, #addtask textarea").each(function(){$(this).on("change keypress",function(e){$("[data-"+$(this).attr("id")+"]").html(e.target.value)})}),$(".timedemo").attr("data-original-title",moment(Date.now()).format("DD/MM/YYYY")+" lúc "+moment(Date.now()).format("HH:mm")),$(".timedemo").html(moment(Date.now()).fromNow())}checkLogin("createtask"),$(document).ready(function(){__addTask_submitForm(),buildDemoTask(),$("#cru").html(localStorage.getItem("CurrentUser")),$.ajax({url:Global.API_URL+"/user.json",type:"GET",async:!0,dataType:"json",cache:!0,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+Cookies.get("Token"))},error:function(e,t,a){},complete:function(e){var t=JSON.parse(e.responseText),a=[];for(var o in t)if(t.hasOwnProperty(o)){var r=t[o],n='<option value="'+o+'" data-email="'+r.email+'" data-fullname="'+r.fullname+'">'+r.fullname+" ("+r.username+")</option>";a.push(n)}$("#asuser").html(a).select2({}).on("select2:opening",function(e){App.workID=e.target.value,App.from=localStorage.getItem("FullName")+" <"+localStorage.getItem("CurrentEmail")+">",App.to=$(this).find(":selected").data("fullname")+" <"+$(this).find(":selected").data("email")+">"}).on("change",function(e){App.workID=e.target.value,App.from=localStorage.getItem("FullName")+" <"+localStorage.getItem("CurrentEmail")+">",App.to=$(this).find(":selected").data("fullname")+" <"+$(this).find(":selected").data("email")+">"})}})});