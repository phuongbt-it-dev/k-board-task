"use strict";var Global={API_URL:"/data",URLPath:""},App={Data:null,txtNewSelect:"",txtNewTitle:"",txtNewDate:"",txtNewMesage:"",txtNewProject:"",txtNewColor:"",txtNewMaterial:"",workID:1,from:null,to:null,__template:function(e,t,i,o,n,a,s,r,l,c,d,m,u,g){var h=makeid(10),p="";return a&&0<a.length&&(p=" hasfile"),'<li class="list-group-item list-group-item-action status-'+t+p+'" id="'+checkNull(e)+'"><div class="move"></div><div class="content"><div class="pot pot-'+checkNull(t)+'"><a href="/gettask?id='+e+'"><h3 class="text-bold">'+checkNull(g)+": <small>"+checkNull(i)+'</small></h3></a><div class="gm mb-0 pt-1 pb-1 pr-5">'+checkNull(n)+'<button class="pdf btn btn-link btn-sm" type="button" data-toggle="modal" data-target="#pdfModal" data-backdrop="static" data-keyboard="false" data-files="'+checkNull(a)+'">Xem PDF<i class="fa fa-file-pdf ml-2"></i></button><button class="btn btn-sm btn-tg collapsed" type="button" data-toggle="collapse" data-target="#'+h+'" aria-expanded="false" aria-controls="'+h+'"><i class="fa fa-angle-down"></i></button><button class="btn btn-sm btn-move" type="button" onclick="moveTask(this)"><i class="fa fa-angle-right"></i></button></div></div><div class="collapse" id="'+h+'"><div class="details small"><hr><div class="row"><div class="col"><i class="fa fa-briefcase mr-2"></i>'+checkNull(c)+'</div><div class="col-auto"><span>'+checkNull(d)+'</span></div><div class="col-auto"><span>'+checkNull(m)+'</span></div></div></div><hr><div class="create small"><div class="row no-gutters"><div class="col"><i class="fa fa-user mr-2"></i><a href="/getuser?id='+s+'">'+checkNull(getUserName(s))+'</a></div><div class="col-auto"><span class="text-date" data-toggle="tooltip" data-placement="top" title="'+moment(checkNull(o)).format("DD/MM/YYYY")+" lúc "+moment(checkNull(o)).format("HH:mm")+'">'+moment(checkNull(o),"YYYYMMDD").fromNow()+'</span></div></div><hr><div class="row no-gutters"><div class="col"><i class="fa fa-cog mr-2"></i><a href="/getuser?id='+r+'">'+checkNull(getUserName(r))+'</a></div><div class="col-auto"><span class="text-date" data-toggle="tooltip" data-placement="top" title="'+moment(checkNull(l)).format("DD/MM/YYYY")+" lúc "+moment(checkNull(l)).format("HH:mm")+'">'+moment(checkNull(l),"YYYYMMDD").fromNow()+"</span></div></div></div></div></div></li>"}},Settings={GlobalName:"K-DB-",Editor:!0,pageSize:5,ActiveNumberStep1Drag:3,ActiveNumberStep2Drop:1,OneWay:!0,Permission:{ActiveDashboard:!1,CreateTask:!1,Settings:!1,DeleteTask:!1,ModifyTask:!1,UserList:!1,AddUser:!1,ViewTask:!1,ArchiveTask:!1,MoveTask:!1,ViewUser:!1}};function checkNull(e){var t=e;return t||0<t.length?t:"Chưa xác định"}function __main__callAction(){$(".pdf").each(function(){$(this).click(function(){var e=$(this).parents(".content").find("h3").html(),t=$(this).attr("data-files");$("#pdfModal .modal-title").html(e),$("#pdfModal .modal-body").html("<iframe></iframe>"),$("#pdfModal .modal-body iframe").attr("src",Global.URLPath+"/pdfjs/web/viewer.html?files=/files/"+t),setTimeout(function(){var e=$("#pdfModal .modal-body").height();$("#pdfModal .modal-body iframe").css({height:e+"px"}),$("#pdfModal .modal-body").css({height:e+"px"})},1e3)})})}function __main__addForm(){__main__checkContent(),$("#pdfModal").on("hidden.bs.modal",function(e){$("#pdfModal .modal-body").html("Đang tải...")})}function toastrMsg(e,t,i){toastr.success(e,t,{closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!0,positionClass:"toast-bottom-right",preventDuplicates:!1,onclick:null,showDuration:300,hideDuration:1e3,timeOut:i,extendedTimeOut:1e3,showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"})}function __main__updateOrder(e){$('[data-step="'+e+'"]').each(function(){var t=0;$(this).find("li").each(function(){var e=$(this).attr("id");$.ajax({url:"/order",type:"POST",async:!1,dataType:"json",cache:!0,data:{id:e,order:t},complete:function(e){}}),t++})})}function __main__checkContent(){$("#k-board-task .sortable").each(function(){0<$(this).html().length?$(this).addClass("active"):$(this).removeClass("active")})}function initIframe(){}function getUserName(e){var o=e,n=null;if($.ajax({url:Global.API_URL+"/user.json?id="+o,type:"GET",async:!1,dataType:"json",cache:!0,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+Cookies.get("Token"))},error:function(e,t,i){},complete:function(e){var t=JSON.parse(e.responseText);for(var i in t)t.hasOwnProperty(i)&&i===o.toString()&&(t=t[i],n=t.fullname)}}),n)return n}function checkLogin(e){md5(localStorage.getItem("CurrentUser")+localStorage.getItem("CurrentEmail"))===Cookies.get("Token")?"/login"===window.location.pathname?window.location.href="/":checkPermission(e):e&&(window.location.href="/login")}function checkPermission(n){var a=localStorage.getItem("CurrentUserID"),s=!1;$.ajax({url:Global.API_URL+"/user.json?id="+a,type:"GET",async:!1,dataType:"json",cache:!0,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+Cookies.get("Token"))},error:function(e,t,i){},complete:function(e){var t=JSON.parse(e.responseText);for(var i in t)if(t.hasOwnProperty(i)){var o=md5(t[i].username+t[i].email);i===a&&o===Cookies.get("Token")&&(Settings.Permission.ActiveDashboard=t[i].permision.dashboard,Settings.Permission.CreateTask=t[i].permision.createtask,Settings.Permission.Settings=t[i].permision.settings,Settings.Permission.DeleteTask=t[i].permision.deltassk,Settings.Permission.ModifyTask=t[i].permision.modifytask,Settings.Permission.UserList=t[i].permision.userlist,Settings.Permission.AddUser=t[i].permision.adduser,Settings.Permission.ArchiveTask=t[i].permision.archivetask,Settings.Permission.ViewTask=t[i].permision.viewtask,Settings.Permission.ViewUser=t[i].permision.viewuser,Settings.Permission.MoveTask=t[i].permision.movetask,Settings.Editor=t[i].settings.editor,Settings.pageSize=t[i].settings.pagesize,Settings.ActiveNumberStep1Drag=t[i].settings.activenumberstep1drag,Settings.ActiveNumberStep2Drop=t[i].settings.activenumberstep2drop,Settings.OneWay=t[i].settings.oneway,n&&1==n?s=!0:("createtask"===n&&(s=!!Settings.Permission.CreateTask),"settings"===n&&(s=!!Settings.Permission.Settings),"adduser"===n&&(s=!!Settings.Permission.AddUser),"archivetask"===n&&(s=!!Settings.Permission.ArchiveTask),"viewtask"===n&&(s=!!Settings.Permission.ViewTask),"userlist"===n&&(s=!!Settings.Permission.UserList),"viewuser"===n&&(s=!!Settings.Permission.ViewUser),"movetask"===n&&(s=!!Settings.Permission.MoveTask)))}}}),s?$(".waitforpermission").removeClass("waitforpermission"):window.location.href="/nopermission"}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function makeid(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=0;o<e;o++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}function checkReadyLogin(){localStorage.getItem("Token")&&0<localStorage.getItem("Token").length?$("#login").hide():$("#login").show()}function logOut(){localStorage.removeItem("CurrentUser"),localStorage.removeItem("CurrentUserID"),localStorage.removeItem("CurrentEmail"),localStorage.removeItem("FullName"),window.location.href="/login",Cookies.remove("Token"),window.location.href="/login"}function getInfoUser(){localStorage.getItem("CurrentUserID")&&0<localStorage.getItem("CurrentUserID").length&&(window.location.href="/getuser?id="+localStorage.getItem("CurrentUserID"))}function b64EncodeUnicode(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}function b64DecodeUnicode(e){return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function ccCreateRipple(){$("[ripple]").on("click",function(e){var t=$('<div class="ripple" />'),i=$(this).offset(),o=e.pageY-i.top,n=e.pageX-i.left,a=$(".ripple");t.css({top:o-a.height()/2,left:n-a.width()/2,background:$(this).attr("ripple-color")}).appendTo($(this)),window.setTimeout(function(){t.remove()},1500)})}function checkPermissionOnMenu(){Settings.Permission.UserList&&$("#pr_users").removeClass("d-none"),Settings.Permission.CreateTask&&$("#pr_createtask").removeClass("d-none"),Settings.Permission.Settings&&$("#pr_settings").removeClass("d-none"),Settings.Permission.ArchiveTask&&$("#pr_archive").removeClass("d-none")}function setFooter(){var e=$("body").outerHeight(),t=($("header").outerHeight(),$("footer").outerHeight()),i=e-t;$(window).width(),$("main").css("min-height",i+"px")}function searchGlobal(){$.ajax({url:Global.API_URL+"/tasks.json",type:"GET",async:!1,dataType:"json",cache:!0,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+Cookies.get("Token"))},error:function(e,t,i){},complete:function(e){var i=JSON.parse(e.responseText);$("#searchsite .typeahead").typeahead(null,{source:function(t,e){e(i.filter(function(e){return"N"!==e.State&&(e.ObjectType.includes(t)||e.Name.includes(t)||e.MetaDescription.includes(t)||e.Material.includes(t))}))},updater:function(e){return selectedState=map[e].ObjectType,e},matcher:function(e){if(-1!=e.toLowerCase().indexOf(this.query.trim().toLowerCase()))return!0},sorter:function(e){return e.sort()},highlighter:function(e){var t=new RegExp("("+this.query+")","gi");return e.replace(t,"<strong>$1</strong>")},hint:!0,highlight:!0,minLength:1,limit:5,name:"dataSource",display:["ObjectType","Name","MetaDescription","Material"],templates:{empty:['<div class="p-2 small text-center">',"Không tìm thấy nhiệm vụ nào!","</div>"].join("\n"),suggestion:function(e){return"<div><strong>"+e.ObjectType+"</strong><div><small>"+e.Name+"</small></div></div>"}}}).bind("typeahead:select",function(e,t){window.location.href="/gettask?id="+t.ObjectId})}})}document.onkeyup=function(e){if((e=e||window.event).altKey&&e.ctrlKey&&e.shiftKey&&13==e.which)return $("body"),alert(b64DecodeUnicode("QkFPIE5HVVlFTiAtIDA5Njk2ODk4OTMKRW1haWw6IGJhb25ndXllbnlhbUBnbWFpbC5jb20KV2ViOiBiYW9uZ3V5ZW55YW0uZ2l0aHViLmlv")),!1},$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(document).ready(function(){checkReadyLogin()}),$(document).ready(function(){ccCreateRipple(),checkPermissionOnMenu(),$("header .name").html(localStorage.getItem("FullName")),setFooter(),searchGlobal(),Settings.Permission.AddUser||$("header #info").remove()}),$(window).resize(function(){setFooter()});